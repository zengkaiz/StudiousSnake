# 贪学蛇 - 系统架构设计

## 🏗️ 整体架构图

```
┌─────────────────────────────────────────────────────────────────┐
│                        用户层 (User Layer)                        │
├─────────────────────────────────────────────────────────────────┤
│  Web Browser  │  Mobile App  │  Desktop App  │  API Client      │
└─────────────────────────────────────────────────────────────────┘
                                │
                                ▼
┌─────────────────────────────────────────────────────────────────┐
│                      前端层 (Frontend Layer)                      │
├─────────────────────────────────────────────────────────────────┤
│  Vue 3 + TypeScript  │  Naive UI  │  Tailwind CSS  │  PWA    │
└─────────────────────────────────────────────────────────────────┘
                                │
                                ▼
┌─────────────────────────────────────────────────────────────────┐
│                     网关层 (Gateway Layer)                       │
├─────────────────────────────────────────────────────────────────┤
│  Nginx  │  Load Balancer  │  CDN  │  SSL Termination  │  CORS  │
└─────────────────────────────────────────────────────────────────┘
                                │
                                ▼
┌─────────────────────────────────────────────────────────────────┐
│                     应用层 (Application Layer)                  │
├─────────────────────────────────────────────────────────────────┤
│  NestJS API Server  │  Authentication  │  Authorization  │  CORS │
└─────────────────────────────────────────────────────────────────┘
                                │
                                ▼
┌─────────────────────────────────────────────────────────────────┐
│                     业务层 (Business Layer)                     │
├─────────────────────────────────────────────────────────────────┤
│  Project Service  │  Study Service  │  User Service  │  File Service │
└─────────────────────────────────────────────────────────────────┘
                                │
                                ▼
┌─────────────────────────────────────────────────────────────────┐
│                     数据层 (Data Layer)                         │
├─────────────────────────────────────────────────────────────────┤
│  PostgreSQL  │  Redis Cache  │  File Storage  │  Backup Storage │
└─────────────────────────────────────────────────────────────────┘
```

## 🔧 技术栈架构

### 前端架构

```
贪学蛇前端应用
├── 核心框架
│   ├── Vue 3 (Composition API)
│   ├── TypeScript
│   └── Vite (构建工具)
├── UI 组件
│   ├── Naive UI (组件库)
│   ├── Tailwind CSS (样式)
│   └── 自定义组件
├── 状态管理
│   ├── Pinia (状态管理)
│   ├── Vue Router (路由)
│   └── 本地存储
├── 功能模块
│   ├── 认证模块
│   ├── 项目管理
│   ├── 学习记录
│   ├── 日历视图
│   └── 数据统计
└── 工具库
    ├── Axios (HTTP 客户端)
    ├── Day.js (日期处理)
    ├── Marked (Markdown 解析)
    └── ECharts (图表库)
```

### 后端架构

```
贪学蛇后端服务
├── 核心框架
│   ├── NestJS (Node.js 框架)
│   ├── TypeScript
│   └── Express (底层)
├── 数据层
│   ├── Prisma (ORM)
│   ├── PostgreSQL (主数据库)
│   └── Redis (缓存)
├── 认证授权
│   ├── JWT (身份认证)
│   ├── Passport (策略)
│   └── bcrypt (密码加密)
├── 业务服务
│   ├── 用户服务
│   ├── 项目服务
│   ├── 学习记录服务
│   ├── 文件服务
│   └── 统计服务
├── 中间件
│   ├── 认证中间件
│   ├── 日志中间件
│   ├── 错误处理
│   └── 数据验证
└── 工具库
    ├── class-validator (数据验证)
    ├── class-transformer (数据转换)
    └── multer (文件上传)
```

## 📊 数据流架构

### 用户操作流程

```
用户操作 → 前端组件 → Pinia Store → API 调用 → 后端服务 → 数据库
    ↓
用户界面更新 ← 状态更新 ← 响应处理 ← 业务逻辑 ← 数据查询
```

### 数据同步流程

```
前端状态 ←→ API 接口 ←→ 业务逻辑 ←→ 数据库
    ↓
本地缓存 ←→ 实时更新 ←→ 数据验证 ←→ 事务处理
```

## 🔐 安全架构

### 认证授权流程

```
用户登录 → 密码验证 → JWT 生成 → Token 存储 → 请求验证
    ↓
权限检查 → 资源访问 → 操作授权 → 日志记录 → 安全审计
```

### 数据安全保护

```
输入验证 → 数据清洗 → 权限控制 → 加密存储 → 访问审计
    ↓
XSS 防护 ← SQL 注入防护 ← CSRF 防护 ← 文件安全 ← 传输加密
```

## 🚀 部署架构

### 开发环境

```
开发者本地
├── 前端开发服务器 (Vite Dev Server)
├── 后端开发服务器 (NestJS Dev)
├── 数据库 (Docker PostgreSQL)
└── 缓存 (Docker Redis)
```

### 生产环境

```
云服务部署
├── 前端部署 (Vercel)
│   ├── 自动构建
│   ├── CDN 加速
│   └── HTTPS 证书
├── 后端部署 (Railway)
│   ├── 自动部署
│   ├── 负载均衡
│   └── 监控告警
├── 数据库 (PostgreSQL)
│   ├── 主从复制
│   ├── 定期备份
│   └── 性能监控
└── 文件存储 (AWS S3)
    ├── 对象存储
    ├── 访问控制
    └── 备份策略
```

## 📈 性能架构

### 前端性能优化

```
性能优化策略
├── 代码分割 (Code Splitting)
├── 懒加载 (Lazy Loading)
├── 图片优化
├── 缓存策略
└── 压缩优化
```

### 后端性能优化

```
性能优化策略
├── 数据库索引
├── 查询优化
├── 缓存策略
├── 连接池
└── 异步处理
```

## 🔄 扩展架构

### 微服务架构 (未来)

```
微服务架构
├── 用户服务 (User Service)
├── 项目服务 (Project Service)
├── 学习服务 (Study Service)
├── 文件服务 (File Service)
├── 通知服务 (Notification Service)
└── 分析服务 (Analytics Service)
```

### 移动端架构 (未来)

```
移动端应用
├── React Native / Flutter
├── 原生功能集成
├── 离线数据同步
└── 推送通知
```

## 📋 架构决策记录

### ADR-001: 选择 Vue 3 作为前端框架

**决策**: 使用 Vue 3 + TypeScript + Composition API  
**理由**:

- 更好的 TypeScript 支持
- 更灵活的组合式 API
- 更好的性能表现
- 丰富的生态系统

### ADR-002: 选择 NestJS 作为后端框架

**决策**: 使用 NestJS + TypeScript  
**理由**:

- 企业级 Node.js 框架
- 优秀的 TypeScript 支持
- 模块化架构设计
- 丰富的装饰器支持

### ADR-003: 选择 PostgreSQL 作为主数据库

**决策**: 使用 PostgreSQL + Prisma ORM  
**理由**:

- 强大的关系型数据库
- 优秀的 JSON 支持
- 丰富的扩展功能
- 良好的性能表现

### ADR-004: 选择 Vercel + Railway 作为部署平台

**决策**: 使用 Vercel (前端) + Railway (后端)  
**理由**:

- 零运维成本
- 自动部署
- 全球 CDN
- 优秀的开发者体验

---

_本文档将随着架构演进持续更新_
